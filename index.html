<!doctype html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Fresin Member App</title>
	<link rel="preload" as="image" href="https://freeimage.host/i/fzLDWKb">


  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(30,58,138,0.06) 0%, rgba(16,185,129,0.03) 12%, rgba(245,158,11,0.08) 40%, rgba(245,158,11,0.12) 70%), 
                  linear-gradient(180deg, #F6F9F6 0%, #F7F3E6 100%);
    }
	
	.header-top {
  background: linear-gradient(90deg, #1E3A8A 0%, #2563EB 100%);
  border-radius: 22px 22px 0 0; 
  padding: 30px 10px;
  text-align: center;
  color: white;

  margin-left: -24px;   /* tambahkan */
  margin-right: -24px;  /* tambahkan */
  margin-top: -24px;    /* tambahkan */
  width: calc(100% + 48px); /* tambahkan agar tetap pas */
}
	  
.header-top h1 {
  color: #fff;
  font-size: 28px;          /* besar seperti screenshot */
  font-weight: 700;
  margin-bottom: 0px;       /* jarak kecil ke subjudul */
}

.header-top p {
  color: rgba(255,255,255,0.95);
  font-size: 15px;          /* lebih besar dari sebelumnya */
  font-weight: 500;
  margin: 0;
}



    .card {
  max-width: 380px;
  margin: 28px auto;
  border-radius: 22px;
  background: white;
  box-shadow: 0 10px 30px rgba(2,6,23,0.12);
  padding: 24px;  /* KEMBALIKAN */
  border: 1px solid rgba(17,24,39,0.05);
}

    .input-base {
      width: 100%;
      background: #fff;
      border-radius: 14px;
      padding: 14px 16px 14px 46px;
      border: 1.5px solid rgba(59,130,246,0.15);
      box-shadow: 0 4px 12px rgba(59,130,246,0.05);
      outline: none;
      font-size: 14px;
      transition: .15s ease;
    }
    .input-base:focus {
      border-color: rgba(59,130,246,0.35);
      box-shadow: 0 8px 28px rgba(59,130,246,0.18);
      transform: translateY(-1px);
    }

    .label-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
      font-weight: 600;
      color: #0f172a;
      font-size: 13px;
    }

    .upload-box {
      border: 2px dashed rgba(59,130,246,0.22);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      background: linear-gradient(180deg, rgba(59,130,246,0.02), rgba(249,250,251,0.01));
      cursor: pointer;
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      border-radius: 14px;
      font-weight: 800;
      color: white;
      font-size: 15px;
      background: linear-gradient(90deg, #1E3A8A 0%, #2563EB 100%);
      box-shadow: 0 12px 30px rgba(13,71,161,0.18);
      border: none;
    }

#summaryBox {
  width: min(92vw, 430px);
  margin: 30px auto 40px auto;
  border-radius: 22px;
  background: linear-gradient(90deg, #1E3A8A 0%, #2563EB 100%) !important;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
  padding-top: 18px;
  padding-bottom: 28px;
  /* jangan ada display di sini */
}


.summary-warning {
  background: #FFD580;            /* âœ… oranye terang lembut */
  border-left: 4px solid #FFB703; /* âœ… oranye agak lebih gelap */
  padding: 14px;
  border-radius: 14px;
  margin: 20px 20px 10px 20px;
  color: #7a3e00;                 /* âœ… teks coklat gelap agar kontras */
}

.summary-warning p,
.summary-warning strong,
.summary-warning span {
  color: black !important; /* pastikan semua putih */
}

	  .summary-field {
  margin-left: 30px;
  margin-right: 30px;
}

    .sum-photo-wrapper {
      width: 72%;
      max-width: 300px;
      aspect-ratio: 4/5;
      margin: 0 auto;
      border-radius: 16px;
      padding: 6px;
      border: 4px solid #FFD54A;
      background: white;
    }
    #sumPhoto { width:100%; height:100%; object-fit:cover; border-radius:14px; }

  </style>
</head>

<body class="h-full">

  <div class="min-h-full flex items-start justify-center px-4 py-8">
    <div class="w-full">

      <!-- FORM -->
      <div id="registration-form" class="card">

        <div class="header-top">
  <h1>Fresin Indonesia</h1>
  <p>Member Registration</p>
</div>



        <form id="memberForm" class="space-y-4 mt-8">

          <!-- Nama -->
          <div>
            <div class="label-row"><span>ðŸ‘¤</span><label>Nama Lengkap</label></div>
            <input type="text" id="nama" class="input-base" required placeholder="Masukkan nama lengkap">
          </div>

          <!-- WhatsApp -->
          <div>
            <div class="label-row"><span>ðŸ“±</span><label>Nomor WhatsApp</label></div>
            <input type="tel" id="whatsapp" class="input-base" required placeholder="08xxxxxxxxxx">
            <p class="text-xs text-gray-500 mt-1">Pastikan nomor whatsapp yang aktif ya</p>
          </div>

          <!-- Foto -->
          <div>
            <div class="label-row"><span>ðŸ“¸</span><label>Foto Diri</label></div>

            <input type="file" id="fileInput" accept="image/*" class="hidden">

            <button type="button" onclick="openFotoModal()" class="w-full" style="background:transparent;border:none;">
              <div class="upload-box" id="uploadBox">
                <div id="uploadIcon" class="text-4xl">ðŸ“·</div>
                <div id="uploadText" class="font-semibold mt-1">Pilih Foto</div>
                <p class="text-xs text-gray-500 mt-1">*Pilih foto dengan wajah terlihat jelas ya</p>
              </div>
            </button>
          </div>

          <!-- Kode -->
          <div>
            <div class="label-row"><span>ðŸ’³</span><label>Kode Validasi</label></div>
            <input type="password" id="kodePembayaran" class="input-base" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off" onpaste="return false">
            <p class="text-xs text-gray-500 mt-1">Otomatis terisi jika scan QR link dari Kasir</p>
          </div>

          <button id="submitBtn" type="submit" class="btn-primary">
            <span>ðŸš€</span> <span id="submitText">DAFTAR SEKARANG</span>
          </button>

        </form>

      </div>

      <!-- SUMMARY (TIDAK BOLEH DIUBAH) -->
      <div id="summaryBox" class="mt-6 hidden">

        <div class="text-center mb-4">
  <h2 class="text-2xl font-extrabold text-white">
    Pendaftaran Berhasil
  </h2>
  <p class="text-white opacity-90">
    Selamat bergabung member Fresin!
  </p>
</div>


        <div class="flex justify-center mb-4">
          <div class="sum-photo-wrapper">
            <img id="sumPhoto">
          </div>
        </div>

        <div class="space-y-2 px-4">
          <div class="bg-white rounded-xl py-2 text-center shadow-sm summary-field">
            <p class="text-xs text-gray-500">NAMA MEMBER</p>
            <p id="sumName" class="font-bold text-gray-800"></p>
          </div>
          <div class="bg-white rounded-xl py-2 text-center shadow-sm summary-field">
            <p class="text-xs text-gray-500">WHATSAPP</p>
            <p id="sumWa" class="font-bold text-gray-800"></p>
          </div>
          <div class="bg-white rounded-xl py-2 text-center shadow-sm summary-field">
            <p class="text-xs text-gray-500">TANGGAL DAFTAR</p>
            <p id="sumDate" class="font-bold text-gray-800"></p>
          </div>
        </div>

        <div class="summary-warning">
          <div class="flex space-x-2">
            <span class="text-orange-500 text-xl">ðŸ“±</span>
            <p class="text-sm text-gray-700 leading-tight">
              <strong>Penting!</strong><br>
              Screenshoot laman ini dan tunjukkan pada kasir saat bertransaksi.
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>

	<div id="modalError" class="fixed inset-0 bg-black bg-opacity-50 hidden 
    flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-6 w-72 text-center shadow-xl">
    <h2 class="text-lg font-bold text-gray-800 mb-2" id="modalErrorTitle">
      Nomor WhatsApp sudah terdaftar
    </h2>
    <p class="text-sm text-gray-600 mb-5" id="modalErrorText">
      Coba pakai nomor lain ya
    </p>

    <button id="modalErrorBtn"
      class="w-full bg-green-500 text-white py-2 rounded-xl font-semibold 
             active:scale-95 transition">
      Oke
    </button>
  </div>
</div>


  <!-- IMAGE COMPRESS -->
  <script>
    function compressImage(file, maxSize = 1280, quality = 0.8) {
      return new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = event => {
          const img = new Image();
          img.onload = () => {
            let w = img.width, h = img.height;
            if (w > h && w > maxSize) { h *= maxSize / w; w = maxSize; }
            else if (h > maxSize) { w *= maxSize / h; h = maxSize; }

            const c = document.createElement('canvas');
            c.width = w; c.height = h;
            c.getContext('2d').drawImage(img, 0, 0, w, h);
            resolve(c.toDataURL("image/jpeg", quality));
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    let compressedDataUrl = "";
  </script>

  <!-- FILE UPLOAD EVENT -->
  <script>
    document.getElementById('fileInput').addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;
      compressedDataUrl = await compressImage(file, 900, 0.75);

      document.getElementById('uploadIcon').innerText = "âœ“";
      document.getElementById('uploadIcon').classList.add("text-green-600");
      document.getElementById('uploadText').innerText = "Foto sudah dipilih";
    });
  </script>

  <!-- ENDPOINT GAS -->
  <script>
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbzdwoTAA0Rj2hOzACDwDSzrwsjgYUPkGqYq045097udogbxv8ex7rOkDNZJPwWH2h8h/exec"; 
  </script>

  <!-- SUBMIT FORM -->
  <script>
    document.getElementById('memberForm').addEventListener('submit', function(e){
      e.preventDefault();

      const nama = document.getElementById('nama').value;
      const whatsapp = document.getElementById('whatsapp').value;
      const kode = document.getElementById('kodePembayaran').value;
      const foto = compressedDataUrl;

      if (!nama) {
  document.getElementById("nama").reportValidity();
  return;
}

if (!whatsapp) {
  document.getElementById("whatsapp").reportValidity();
  return;
}

if (!kode) {
  document.getElementById("kodePembayaran").reportValidity();
  return;
}

if (!foto) {
  document.getElementById("fileInput").click(); // arahkan user ke upload
  return;
}

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      document.getElementById('submitText').innerText = "Mendaftar...";

      const formData = new FormData();
      formData.append("action", "simpanData");
      formData.append("nama", nama);
      formData.append("whatsapp", whatsapp);
      formData.append("kode", kode);
      formData.append("fotoBase64", foto);

      fetch(ENDPOINT, {
        method: "POST",
        body: formData
      })
      .then(r => r.json())
      .then(res => {

        btn.disabled = false;
        document.getElementById('submitText').innerText = "DAFTAR SEKARANG";

        if (!res.success) {

  // âœ… JIKA KODE VALIDASI SALAH
  if (res.message && res.message.toLowerCase().includes("kode")) {
    showErrorModal(
      "Kode Validasi Salah",
      "Dapatkan kode dari kasir setelah pembayaran"
    );
    return;
  }

  // âœ… JIKA NOMOR WHATSAPP SUDAH TERDAFTAR
  if (res.message && res.message.toLowerCase().includes("whatsapp")) {
    showErrorModal(
      "Nomor WhatsApp sudah terdaftar",
      "Coba pakai nomor lain ya"
    );
    return;
  }

  // âœ… FALLBACK JIKA ERROR LAIN
  showErrorModal(
    "Terjadi Kesalahan",
    res.message || "Silakan coba lagi"
  );
  return;
}


        document.getElementById('sumPhoto').src = foto;
        document.getElementById('sumName').innerText = nama;
        document.getElementById('sumWa').innerText = whatsapp;
        const today = new Date();
document.getElementById('sumDate').innerText = 
    today.toLocaleDateString('id-ID', { day:'2-digit', month:'2-digit', year:'numeric' });


        document.getElementById('registration-form').style.display = "none";
        document.getElementById('summaryBox').classList.remove('hidden');

      })
      .catch(err => {
        console.error(err);
        alert("Gagal menghubungi server.");
      });

    });
  </script>

  <!-- AUTOFILL + LOCK -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const kodeURL = params.get("kode");

    if (kodeURL) {
      document.getElementById("kodePembayaran").value = kodeURL;
      document.getElementById("kodePembayaran").readOnly = true;
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  </script>

	<script>
function showErrorModal(title, message) {
  document.getElementById("modalErrorTitle").innerText = title;
  document.getElementById("modalErrorText").innerText = message;
  document.getElementById("modalError").classList.remove("hidden");
}

document.getElementById("modalErrorBtn").addEventListener("click", () => {
  document.getElementById("modalError").classList.add("hidden");
});
</script>

	<script>
function openFotoModal() {
  const modal = document.getElementById("modalFoto");
  if (modal) {
    modal.classList.remove("hidden");
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const modalFotoBtn = document.getElementById("modalFotoBtn");
  const modalFoto    = document.getElementById("modalFoto");
  const fileInput   = document.getElementById("fileInput");

  if (modalFotoBtn && modalFoto && fileInput) {
    modalFotoBtn.addEventListener("click", () => {
      modalFoto.classList.add("hidden");
      fileInput.click(); // âœ… baru buka galeri
    });
  }
});
</script>


	<script>
  const requiredFields = [
    { id: "nama", msg: "Tolong isi kolom ini ya" },
    { id: "whatsapp", msg: "Tolong isi kolom ini ya" },
    { id: "kodePembayaran", msg: "Tolong isi kolom ini ya" }
  ];

  requiredFields.forEach(field => {
    const input = document.getElementById(field.id);

    input.setCustomValidity(field.msg);

    input.addEventListener("input", () => {
      if (input.value.trim() !== "") {
        input.setCustomValidity("");
      } else {
        input.setCustomValidity(field.msg);
      }
    });
  });
</script>

	<script>
const preloadFotoPanduan = new Image();
preloadFotoPanduan.src = "https://freeimage.host/i/fzLDWKb";
</script>

	<!-- MODAL INFO FOTO -->
<div id="modalFoto" class="fixed inset-0 bg-black bg-opacity-50 hidden 
  flex items-center justify-center z-50">

  <div class="bg-white rounded-2xl p-6 w-72 text-center shadow-xl">
    
    <!-- GAMBAR -->
    <img 
  src="https://freeimage.host/i/fzLDWKb"
  loading="eager"
  width="180"
  height="180"
  class="w-44 mx-auto mb-1"
  onerror="this.style.display='none'">


    <!-- TEKS -->
    <p class="text-sm font-semibold text-gray-700 mb-5">
  Pilih foto dengan wajah terlihat jelas ya
</p>

    <!-- TOMBOL -->
    <button id="modalFotoBtn"
      class="w-full bg-blue-600 text-white py-2 rounded-xl font-semibold 
             active:scale-95 transition">
      Oke
    </button>
  </div>
</div>

</body>
</html>
































